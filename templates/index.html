<!DOCTYPE html>
<html>
<head>
    <title>Media Recommender</title>
    <!-- CSS & JS Linking -->
    <link rel="stylesheet" href="{{ url_for('static', filename='stylesheets/style.css') }}">
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <!-- JQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <!-- FontAwesome Icons -->
    <link rel="stylesheet" href="{{ url_for('static', filename='stylesheets/font-awesome/css/all.min.css') }}">
    <!-- Color Thief -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.0/color-thief.umd.js"></script>
    <!-- JSGlue -->
    {{ JSGlue.include() }}
    <!-- Favicon -->
    <link rel="shortcut icon" href="{{ url_for('static', filename='img/favicon.ico') }}">
</head>
<body onload="main();">
    <div class="wrapper" id="wrapper">
        <div class="navBar leftBar">
            <a href='/index'><div class="iconDiv" id="iconDiv1"><i class="fa-solid fa-house fa-2x"></i></div></a>
            <a href='/watchlist'><div class="iconDiv" id="iconDiv2"><i class="fa-solid fa-bookmark fa-2x"></i></div></a>
            <div class="iconDiv" id="iconDiv3"><i class="fa-solid fa-arrow-up fa-2x"></i></div>
            <div class="iconDiv" id="iconDiv4"><i class="fa-solid fa-thumbs-up fa-2x"></i></div>
            <div class="iconDiv" id="iconDiv5"><i class="fa-solid fa-thumbs-down fa-2x"></i></div>
        </div>
        <div class="iconBar previousRec" id="previousRec">
            <i class="fa-solid fa-angle-left fa-3x"></i>
        </div>
        <div class="iconBar dislike">
            <div class="iconCircle">
                <i class="fa-solid fa-heart-crack fa-4x"></i>
            </div>
        </div>
        <div class="navBar rightBar">
            <a href='/profile'><div class="iconDiv" id="iconDiv6"><i class="fa-solid fa-user fa-2x"></i></div></a>
            <div class="iconDiv" id="iconDiv7"><i class="fa-solid fa-fill fa-2x"></i></div>
            <a href='/logout'><div class="iconDiv" id="iconDiv8"><i class="fa-solid fa-right-from-bracket fa-2x"></i></div></a>
        </div>
        <div class="iconBar like">
            <div class="iconCircle">
                <i class="fa-solid fa-heart fa-4x"></i>
            </div>
        </div>
        <div class="iconBar nextRec" id="nextRec">
            <i class="fa-solid fa-angle-right fa-3x"></i>
        </div>
        <div class="mainContent">
            <div class="contentBox">
                <div class="contentTitle">
                    <h1 id="title">{{data.iloc[id]['Title']}}</h1>
                </div>
                <div class="contentImage" id="contentImage">
                    <img src="{{data.iloc[id]['Thumbnail']}}" id="thumb" crossorigin="anonymous">
                </div>
                <div class="contentRating">
                    <span>IMDb Rating: </span><span id="rating">{{data.iloc[id]['Rating']}}</span>
                </div>
                <div class="contentGenre">
                    <span id="genre">{{''.join(data.iloc[id]['Genre'])}}</span>
                </div>
                <div class="contentDesc">
                    <span id="desc">{{data.iloc[id]['Description']}}</span>
                </div>
            </div>
        </div>
    </div>
    <script>
        const colorThief = new ColorThief();
        const img = document.querySelector('img');
        const wrapper = document.getElementById('wrapper');
        const prev = document.getElementById('previousRec');
        const next = document.getElementById('nextRec');
        let color;
        let var_id=0;
        let var_url = "localhost:5000/stream";

        $.ajax({
                url: "{{url_for('Response')}}",
                type: 'get',
                data: {id: var_id},
                success: function(response){
                }
            });
        
        prev.addEventListener('click', ()=>{
            if(var_id>0)
            {
                var_id-=1
            }
            $.ajax({
                url: "{{url_for('Response')}}",
                type: 'get',
                data: {id: var_id},
                success: function(response){
                }
            });
        });
        
        next.addEventListener('click', ()=>{
                var_id+=1
                $.ajax({
                url: "{{url_for('Response')}}",
                type: 'get',
                data: {id: var_id},
                success: function(response){
                }
            });
        });

        const title = document.getElementById('title');
        const image = document.getElementById('thumb');
        const rating = document.getElementById('rating');
        const genre = document.getElementById('genre');
        const desc = document.getElementById('desc');

        var xhr = new XMLHttpRequest();
        function handleNewData() {
            var messages = xhr.responseText.split('\n');
            title.textContent = messages[0];
            image.src = messages[1];
            rating.textContent = messages[2];
            genre.textContent = messages[3];
            desc.textContent = messages[4];
        }

        var timer2;
        timer2 = setInterval(()=> {
            handleNewData();
            xhr.open('GET', Flask.url_for('Stream'));
            xhr.send();
        }, 100);
    </script>
</body>
</html>